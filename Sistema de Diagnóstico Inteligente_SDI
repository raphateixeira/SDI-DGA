{"cells":[{"cell_type":"markdown","metadata":{"id":"nL8LBPsz0M21"},"source":["### **Universidade Federal do Pará**\n","\n","###**Campus Universitário de Tucuruí**\n","\n","###**Programa de Pós-Graduação em Computação Aplicada - PPCA**"]},{"cell_type":"markdown","metadata":{"id":"y8gg8ByktO-o"},"source":["## Sistema de Diagnóstico Inteligente - SDI\n","\n","Comunicação Drive"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":23570,"status":"ok","timestamp":1741805844832,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"},"user_tz":180},"id":"f_rIU17owhiM","outputId":"945fef2c-96f4-4b39-93a0-1c2a18b42f72"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["#Montar o drive:\n","from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"markdown","metadata":{"id":"8svJGPLDpPMp"},"source":["## Carregamento da Amostra"]},{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":12254,"status":"ok","timestamp":1741817988675,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"},"user_tz":180},"id":"ibkcJwf9h60p","outputId":"1e97ffe6-6bb9-4278-c81d-3c4072afa497"},"outputs":[{"name":"stdout","output_type":"stream","text":["Hidrogênio: 36\n","Metano:     12\n","Etileno:   10\n","Etano:     10\n","Acetileno: 1\n"]}],"source":["H2 = float(input('Hidrogênio: '))\n","CH4 = float(input('Metano:     '))\n","C2H4 = float(input('Etileno:   '))\n","C2H6 = float(input('Etano:     '))\n","C2H2 = float(input('Acetileno: '))\n"]},{"cell_type":"markdown","metadata":{"id":"QgomBIarobV2"},"source":["## Carregamento de Algoritmos: ANN, KNN e DUVAL\n","\n"]},{"cell_type":"code","execution_count":2,"metadata":{"id":"L8Z35twfvzzG","executionInfo":{"status":"ok","timestamp":1741817994104,"user_tz":180,"elapsed":406,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"}}},"outputs":[],"source":["import pickle\n","import numpy as np\n","import pandas as pd"]},{"cell_type":"code","execution_count":3,"metadata":{"id":"ssSBHYMWxwAc","executionInfo":{"status":"ok","timestamp":1741817996630,"user_tz":180,"elapsed":16,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"}}},"outputs":[],"source":["knn_DGA = '/content/drive/MyDrive/Mestrado/Mestrado_Otacílio_Raphael/Codigo2022/knn_DGA.sav'"]},{"cell_type":"code","execution_count":4,"metadata":{"id":"phgjcXwEAiNZ","executionInfo":{"status":"ok","timestamp":1741818003018,"user_tz":180,"elapsed":43,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"}}},"outputs":[],"source":["rnn_DGA = '/content/drive/MyDrive/Mestrado/Mestrado_Otacílio_Raphael/Codigo2022/meuRnn.pkl'"]},{"cell_type":"code","execution_count":5,"metadata":{"id":"zg7EwvebfgkL","executionInfo":{"status":"ok","timestamp":1741818009861,"user_tz":180,"elapsed":3,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"}}},"outputs":[],"source":["def duval (x_test):\n","\n","  PiCH4 =(100*CH4) / (CH4+C2H4+C2H2)\n","  PiC2H4 =(100*C2H4) / (CH4+C2H4+C2H2)\n","  PiC2H2 =(100*C2H2) / (CH4+C2H4+C2H2)\n","\n","# Zona de falhas de Duval\n","  if PiCH4 >= 98:\n","    R = \"DUVAL: Descarga Parcial Tipo Corona\"\n","\n","  elif PiC2H4 < 23 and PiC2H2 >= 13:\n","    R = \"DUVAL: Descarga de Baixa Energia - D1\"\n","\n","  elif PiC2H4 >= 23 and PiC2H2 >= 29:\n","    R = \"DUVAL: Descarga de Alta Energia - D2\"\n","\n","  elif 23 <= PiC2H4 < 40 and 13 <= PiC2H2 < 29:\n","    R = \"DUVAL: Descarga de Alta Energia - D2\"\n","\n","  elif PiC2H4 < 50 and 4 <= PiC2H2 < 13:\n","    R = \"DUVAL: Falha Térmica/Elétrica\"\n","\n","  elif 40 <= PiC2H4 < 50 and 13 <= PiC2H2 < 29:\n","    R = \"DUVAL: Falha Térmica/Elétrica\"\n","\n","  elif PiC2H4 >= 50 and 15 <= PiC2H2 < 29:\n","    R = \"DUVAL: Falha Térmica/Elétrica\"\n","\n","  elif PiCH4 < 98 and PiC2H4 < 20 and PiC2H2 < 4:\n","    R = \"DUVAL: Térmico < 300°C\"\n","\n","  elif 20 <= PiC2H4 < 50 and PiC2H2 < 4:\n","    R = \"DUVAL: Térmico 300°C < T < 700 °C\"\n","\n","  elif PiC2H4 >= 50 and PiC2H2 < 15:\n","    R = \"DUVAL: Térmico > 700 °C\"\n","\n","  else:\n","    R = \"DUVAL: Inconclusivo\"\n","\n","  return R"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"iQg617zswQQI"},"outputs":[],"source":["KNN_DGA = pickle.load(knn_DGA, 'rb')"]},{"cell_type":"code","source":["RNN_DGA = pickle.load(rnn_DGA, 'rb')"],"metadata":{"id":"lYA9-Yyn1tVm"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Z6dTZaquex7E"},"outputs":[],"source":["H2_Media_ln = 2.71161374\n","CH4_Media_ln = 3.30010706\n","C2H4_Media_ln = 2.09968543\n","C2H6_Media_ln = 1.96715411\n","C2H2_Media_ln = -2.86100623"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"WTlejxYQf8kX"},"outputs":[],"source":["H2_Desvio_ln = 2.44189199\n","CH4_Desvio_ln = 1.70911597\n","C2H4_Desvio_ln = 3.03121717\n","C2H6_Desvio_ln = 3.0799964\n","C2H2_Desvio_ln = 3.04023271"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"VWw461DV2kc7"},"outputs":[],"source":["Media = [H2_Media_ln, CH4_Media_ln, C2H4_Media_ln, C2H6_Media_ln, C2H2_Media_ln]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"-0hwcAgk2zbD"},"outputs":[],"source":["Desvio = [H2_Desvio_ln, CH4_Desvio_ln, C2H4_Desvio_ln, C2H6_Desvio_ln, C2H2_Desvio_ln]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"85MqXOFy6ueE"},"outputs":[],"source":["x_test = [H2, CH4, C2H4, C2H6, C2H2]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"uA2Ny_0ah4wt"},"outputs":[],"source":["xl = np.log(x_test)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"eho3gDRvhL6d"},"outputs":[],"source":["x_Normalizado = np.array((xl[:5]-Media[:5])/Desvio[:5]).reshape(1,-1)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"rd1DBzLl3-Z3","executionInfo":{"status":"ok","timestamp":1741805977205,"user_tz":180,"elapsed":19,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"}},"outputId":"db31076f-3b52-4133-b485-33aab00b82e4"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([[0.15538309, 0.16582367, 0.54037177, 0.10890629, 0.94104843]])"]},"metadata":{},"execution_count":16}],"source":["x_Normalizado"]},{"cell_type":"markdown","metadata":{"id":"z5sS97S6KWfw"},"source":["## Predição dos algoritmos"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"iXQkzmUs4Ezq"},"outputs":[],"source":["yk = KNN_DGA.predict(x_Normalizado)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"bLRZb7LEsMXT"},"outputs":[],"source":["if yk == 0:\n","  print('Amostra normal')\n","elif yk == 1:\n","   print('Defeito térmico')\n","elif yk == 2:\n","  print('Defeito elétrico')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"tgIt9Nc4GQTF"},"outputs":[],"source":["yr0 = RNN_DGA.predict(x_Normalizado)\n","yr0 = (yr0 >= 0.5)\n","print(\"\\n\")\n","yr0"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"FjwVvzPkxNtU"},"outputs":[],"source":["yr = pd.DataFrame(yr0, columns=['X1', 'X2', 'X3'])\n","yr"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"LHG9qFOwy7wu"},"outputs":[],"source":["X1 = yr[\"X1\"].values\n","X2 = yr[\"X2\"].values\n","X3 = yr[\"X3\"].values"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"K5Gwtmh00FR0"},"outputs":[],"source":["if X1 == True and X2 == False and X3 == False:\n","  print('Amostra normal')\n","elif X1 == False and X2 == True and X3 == False:\n","  print('Defeito térmico')\n","elif X1 == False and X2 == False and X3 == True:\n","   print('Defeito elétrico')"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":32,"status":"ok","timestamp":1741805998611,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"},"user_tz":180},"id":"iabub2KyUjcr","colab":{"base_uri":"https://localhost:8080/","height":36},"outputId":"564c9bc0-9775-481a-b3aa-a5f27e4aff7a"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["'DUVAL: Térmico > 700 °C'"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"}},"metadata":{},"execution_count":23}],"source":["yd = duval(x_test)\n","yd"]},{"cell_type":"markdown","metadata":{"id":"B6r5RpTIT9kh"},"source":["## Diagnóstico - SDI"]},{"cell_type":"markdown","metadata":{"id":"HIRmNJAB7V3w"},"source":["**Análise de Normalidade**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"QHYOS2er48qD"},"outputs":[],"source":["#CONDIÇÃO 1: KNN=ANN PARA FALHAS\n","\n","if yk == 0 and X1 == True:  # KNN=ANN PARA NORMAIS\n","  print('KNN e Rede Neural - Amostra normal')\n","\n","if yk != 0 and X1 != True: # KNN=ANN PARA FALHAS\n","  print('KNN e Reunral - Prossiga a análise')\n","\n","if yk == 0 and X2 == True or X3 == True: # KNN=NORMAL E ANN=FALHA\n","  print('Realise análise da evolução dos gases - TENDÊNCIA A FALHAS - Rede Neural')\n","\n","if yk != 0 and X1 == True: # KNN=FALHA E ANN=NORMAL\n","  print('Realise análise da evolução dos gases - TENDÊNCIA A FALHAS - K-Vizinhos')\n","\n","\n"]},{"cell_type":"markdown","metadata":{"id":"7BFATHcy7nKN"},"source":["**Tipo de Falha**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"jG-Z-lBl7JAx"},"outputs":[],"source":["  for yr in (RNN_DGA.predict(x_Normalizado)):\n","    if X1 == False and X2 == False and X3 == True:\n","      print('REDE NEURAL: Defeito elétrico')\n","      #print(\"\\n\")\n","  if yk == 1:\n","    print('K-VIZINHOS: Defeito térmico')\n","  for yd in duval(x_test).replace(\"\", \"\"):\n","    print(yd, end=\"\")"]},{"cell_type":"markdown","metadata":{"id":"pOFCf2ql-EAj"},"source":["## Testes SDI"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"n97uznAJ_INN"},"outputs":[],"source":["# Diagrama de Blocos - Sistema de Diagnóstico Inteligente - SDI\n","\n","for yk in (KNN_DGA.predict(x_Normalizado)):\n","  if yk == 0:\n","    print('Amostra normal')\n","    print(\"\\n\")\n","    break\n","for yr in (RNN_DGA.predict(x_Normalizado)):\n","  if X1 == True and X2 == False and X3 == False:\n","    print('REDE NEURAL: Realizar nova coleta de óleo - Discordância entre KNN e ANN')\n","    print(\"\\n\")\n","    break\n","  for yr in (RNN_DGA.predict(x_Normalizado)):\n","    if X1 == False and X2 == True and X3 == False:\n","      print('REDE NEURAL: Defeito térmico')\n","      #print(\"\\n\")\n","  for yr in (RNN_DGA.predict(x_Normalizado)):\n","    if X1 == False and X2 == False and X3 == True:\n","      print('REDE NEURAL: Defeito elétrico')\n","      #print(\"\\n\")\n","  if yk == 1:\n","    print('K-VIZINHOS: Defeito térmico')\n","  for yd in duval(x_test).replace(\"\", \"\"):\n","    print(yd, end=\"\")"]},{"cell_type":"markdown","metadata":{"id":"iywgOFkSOdtr"},"source":["## Interface Gráfica"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Ouyr23cqOb5H"},"outputs":[],"source":["from IPython.core.display import display, Markdown, clear_output\n","import matplotlib.pyplot as plt\n","import ipywidgets as widgets\n","from logging import PlaceHolder"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"A0yE3PkvPYQP"},"outputs":[],"source":["equation = widgets.Text(value = 'sin(x)+cos(x)', PlaceHolder = \"Digite algo:\", description = 'Equação:')\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"UubjNyuKZ_zR"},"outputs":[],"source":["Text_diagnostico = widgets.Text(value = \"\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"SVVSSCEYQ8CN"},"outputs":[],"source":["range_ = widgets.FloatRangeSlider(value = [-5, 5], min = -100, step = 0.1, description = 'Escala:', orientation = 'horizontal', redaout = True, redaout_format = 'd')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"DAiKU7dnSAXl"},"outputs":[],"source":["points1 = widgets.IntText(value = 0, description = '  Hidrogênio:')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"lzjgMy78VRUe"},"outputs":[],"source":["points2 = widgets.IntText(value = 0, description = 'Metano:')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"MAkaGlDzVWGl"},"outputs":[],"source":["points3 = widgets.IntText(value = 0, description = 'Etileno:')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"He_WjOJ5VZTT"},"outputs":[],"source":["points4 = widgets.IntText(value = 0, description = 'Etano:')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"D6Ja9eypVdav"},"outputs":[],"source":["points5 = widgets.IntText(value = 0, description = 'Acetileno:')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":159},"executionInfo":{"elapsed":578,"status":"error","timestamp":1717423612155,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"},"user_tz":180},"id":"WtknVEtzSio0","outputId":"3772802b-c18c-431c-8d05-d166770edc7d"},"outputs":[{"ename":"NameError","evalue":"name 'defdiag' is not defined","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)","\u001b[0;32m<ipython-input-71-901141993795>\u001b[0m in \u001b[0;36m<cell line: 2>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[0;32mfrom\u001b[0m \u001b[0mcodeop\u001b[0m \u001b[0;32mimport\u001b[0m \u001b[0mcompile_command\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 2\u001b[0;31m \u001b[0mbutton\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mwidgets\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mButton\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdescription\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m'Diagnóstico'\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcompile_command\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mdefdiag\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m","\u001b[0;31mNameError\u001b[0m: name 'defdiag' is not defined"]}],"source":["from codeop import compile_command\n","button = widgets.Button(description = 'Diagnóstico', compile_command=defdiag)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"FfMaO60vSsWQ"},"outputs":[],"source":["out = widgets.Output()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":141},"executionInfo":{"elapsed":247,"status":"error","timestamp":1717423617453,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"},"user_tz":180},"id":"32Evduu1TCx6","outputId":"22ee3a7d-8a19-48a3-ea32-6ea3d6f717d4"},"outputs":[{"ename":"NameError","evalue":"name 'button' is not defined","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)","\u001b[0;32m<ipython-input-73-b54efe859ba1>\u001b[0m in \u001b[0;36m<cell line: 1>\u001b[0;34m()\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mgrapher\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mwidgets\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mVBox\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mpoints1\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mpoints2\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mpoints3\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mpoints4\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mpoints5\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mbutton\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mout\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mText_diagnostico\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m","\u001b[0;31mNameError\u001b[0m: name 'button' is not defined"]}],"source":["grapher = widgets.VBox([points1, points2, points3, points4, points5, button, out, Text_diagnostico])"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"5HYhAg4WTX_s"},"outputs":[],"source":["info = Markdown(\"\"\"# Sistema de Diagnóstico Inteligente - SDI\n"," - Digite a amostra gascromatográfica.\n"," - Aperte diagnóstico.\"\"\")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":141},"executionInfo":{"elapsed":4,"status":"error","timestamp":1717423622123,"user":{"displayName":"OTACILIO FILHO","userId":"17747035149879439271"},"user_tz":180},"id":"1UDRZvxtT7rp","outputId":"19ccb3df-0dfe-45e8-c688-53db9764b468"},"outputs":[{"ename":"NameError","evalue":"name 'grapher' is not defined","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)","\u001b[0;32m<ipython-input-75-ecc5b9db6586>\u001b[0m in \u001b[0;36m<cell line: 1>\u001b[0;34m()\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mdisplay\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0minfo\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mgrapher\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m","\u001b[0;31mNameError\u001b[0m: name 'grapher' is not defined"]}],"source":["display(info, grapher)"]}],"metadata":{"colab":{"collapsed_sections":["y8gg8ByktO-o","QgomBIarobV2","z5sS97S6KWfw","5RLMumMiHcSZ","mycPjJyJ5253"],"provenance":[],"mount_file_id":"1BNbWs_tYzGKepSTmI2KYj4AYmYcoPZo4","authorship_tag":"ABX9TyN0pkTKDXquyxBYTTcqDn7F"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}